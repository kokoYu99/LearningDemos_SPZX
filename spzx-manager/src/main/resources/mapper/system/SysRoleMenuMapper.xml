<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.koko.spzx.mapper.SysRoleMenuMapper">

    <!--List<Long> findRoleMenuIdsByRoleId(Long roleId);-->
    <!-- is_half=1代表未勾选(父菜单半开，显示横杠)，is_half=0代表已勾选 -->
    <select id="findRoleMenuIdsByRoleId" resultType="long">
        SELECT
        menu_id
        FROM `sys_role_menu`
        WHERE role_id=#{roleId} and is_deleted=0 and is_half=0
    </select>

    <!-- int deleteRoleMenusByRoleId(Long roleId); -->
    <delete id="deleteRoleMenusByRoleId">
        DELETE FROM `sys_role_menu` WHERE role_id=#{roleId};
    </delete>

    <!-- int doAssign(AssignMenuDto assignMenuDto); -->
    <insert id="doAssign">
        INSERT INTO `sys_role_menu` (role_id, menu_id, is_half) VALUES
        <foreach collection="menuIdList" item="menuInfo" separator=",">
            (#{roleId}, #{menuInfo.id}, #{menuInfo.isHalf})
        </foreach>
    </insert>

    <!--    int updateRoleMenuIsHalf(Long menuId);  -->
    <update id="updateRoleMenuIsHalf">
        UPDATE  `sys_role_menu`
        SET is_half=1
        WHERE menu_id=#{menuId}
    </update>

</mapper>